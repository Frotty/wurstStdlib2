package Base64Tests

import Base64
import Bitwise

@test function base64EncoderTest1()
    let encoder = new Base64Encoder(128)

    encoder.pushByte(0x48)
    encoder.pushByte(0x65)
    encoder.pushByte(0x6c)
    encoder.pushByte(0x6c)
    //
    encoder.pushByte(0x6f)
    encoder.pushByte(0x2c)
    encoder.pushByte(0x20)
    encoder.pushByte(0x77)
    //
    encoder.pushByte(0x6f)
    encoder.pushByte(0x72)
    encoder.pushByte(0x6c)
    encoder.pushByte(0x64)
    //
    encoder.pushByte(0x21)
    encoder.encode()

    assertTrue(encoder.popChunk() == "SGVsbG8sIHdvcmxkIQ==")

@test function base64EncoderTest2()
    let encoder = new Base64Encoder(16)
    encoder.pushInt(byte4(0x48, 0x65, 0x6c, 0x6c).toInt())
    encoder.pushInt(byte4(0x6f, 0x2c, 0x20, 0x77).toInt())
    encoder.pushInt(byte4(0x6f, 0x72, 0x6c, 0x64).toInt())
    encoder.pushInt(byte4(0x21, 0x20, 0x20, 0x20).toInt())    
    encoder.encode()

    assertTrue(encoder.popChunk() == "SGVsbG8sIHdvcmxk")
    assertTrue(encoder.popChunk() == "ISAgIA==")

@test function base64DecoderTest()
    let decoder = new Base64Decoder

    decoder.pushChunk("SGVsbG8sIHdvcmxkIQ==")
    decoder.decode()

    assertTrue(decoder.popByte() == 0x48)
    assertTrue(decoder.popByte() == 0x65)
    assertTrue(decoder.popByte() == 0x6c)
    assertTrue(decoder.popByte() == 0x6c)
    assertTrue(decoder.popByte() == 0x6f)
    assertTrue(decoder.popByte() == 0x2c)
    assertTrue(decoder.popByte() == 0x20)
    assertTrue(decoder.popByte() == 0x77)
    assertTrue(decoder.popByte() == 0x6f)
    assertTrue(decoder.popByte() == 0x72)
    assertTrue(decoder.popByte() == 0x6c)
    assertTrue(decoder.popByte() == 0x64)
    assertTrue(decoder.popByte() == 0x21)